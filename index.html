<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <title>Saringan Kesihatan Paru-paru</title>
  <style>
    .page-title {
  text-align: center;
  padding: 10px;
  margin-bottom: 20px;
  background-color: rgba(0, 0, 0, 0.8); /* black */
  color: white; 
  border-radius: 10px;
  font-size: 20px;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}   
    body {
  font-family: 'Roboto', sans-serif;
  font-size: clamp(0.95rem, 1.5vw, 1rem);
  background-image: url('https://wallpapers.com/images/high/professional-background-kt963tnn91ts60un.webp');
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  padding: clamp(10px, 5vw, 40px);
    }
    .form-container, .puma-container{
      max-width: 600px;
      margin: 20px auto;
      background: rgba(255, 255, 255, 0.8);
      padding: 20px;
      border: 2px solid black;
      border-radius: 8px;
      position: relative;
    }
    
     h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #003366;
    }

    .grid-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 5px;
    }

    .section {
      background: rgba(135, 206, 250, 0.9);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .section h3 {
      margin-top: 0;
      font-size: 1.1rem;
      color: #003366;
      text-align: center;
    }

    ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }

    li {
      margin-bottom: 8px;
      font-size: 0.9rem;
    }
  
    input[type="checkbox"] {
      margin-right: 8px;
    }

    @media (max-width: 600px) {
      h2 {
        font-size: 1.2rem;
      }

      .section h3 {
        font-size: 1rem;
      }
    }
   
    h2, h3 {
      text-align: center;
    }
    .floating-label {
      position: relative;
      margin-bottom: 20px;
    }
    .floating-label input {
      width: 100%;
      padding: 8px 4px 8px;
      border: 1px solid #aaa;
      border-radius: 4px;
      font-size: 16px;
    }
    .floating-label label {
      position: absolute;
      top: 10px;
      left: 8px;
      color: #777;
      background: white;
      padding: 0 4px;
      transition: 0.2s;
      pointer-events: none;
    }
    .floating-label input:focus + label,
    .floating-label input:not(:placeholder-shown) + label {
      top: -10px;
      left: 6px;
      font-size: 12px;
      color: #333;
    }
    input[type="number"], select {
      width: 100%;
      padding: 10px 4px;
      margin-bottom: 5px;
      border: 1px solid #aaa;
      border-radius: 4px;
    }
    
    input[name="nama"],
    input[name="nric"] {
      text-transform: uppercase;
    }
    .section {
      margin-top: 20px;
    }
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 10px;
    }
    .checkbox-group label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: normal;
      padding-right: 8px;
    }
    .checkbox-group input[type="checkbox"] {
      margin-left: 10px;
    }
    .button-container {
      display: flex;
      align-items: center;
    }
    .submit-button {
      position: relative;
      flex: 1;
      padding: 12px;
      background: black;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .submit-button:hover {
      background: #333;
    }
    .spinner {
      display: none;
      width: 20px;
      height: 20px;
      border: 3px solid #ccc;
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    #result {
      margin-top: 20px;
      font-weight: bold;
      text-align: center;
    }
    @media (max-width: 600px) {
    .info-container {
      font-size: 15px;
    }
  }
  </style>
</head>
<body>
  <div class="page-title">  <!-- Page title -->
  <h1>SARINGAN KESIHATAN PARU-PARU</h1>
  <h3>Klinik Kesihatan Batu 9, Cheras</h3>
  </div>
  
  <!-- Semak risiko -->
<div class="info-container" style="
    max-width: 600px;
    margin: 10px auto;
    background: rgba(255, 140, 0, 0.9);
    padding: 20px;
    border: 2px solid black;
    border-radius: 8px;
    font-size: 16px;
    line-height: 1.5;
    color: #000;
">
  <p>
  <strong>Sila semak kumpulan risiko yang berkaitan</strong><br>
  <strong>Sekiranya YA dan berumur:</strong><br>
  40-49 tahun, sila lakukan Ujian Saringan PUMA.<br>
  50-70 tahun, sila lakukan Ujian Saringan PUMA dan Saringan Risiko Kanser Paru-Paru.
  </p>
</div>
  
  <!-- List of risk -->
  <div class="grid-row">
    <!-- Asthma -->
    <div class="section">
      <h3>Asthma</h3>
      <ul>
        <li><label><input type="checkbox" name="asthma_risk" value="Family history of asthma" /> Family history of asthma</label></li>
        <li><label><input type="checkbox" name="asthma_risk" value="Allergies" /> Allergies</label></li>
        <li><label><input type="checkbox" name="asthma_risk" value="Viral respiratory infections" /> Viral respiratory infections</label></li>
        <li><label><input type="checkbox" name="asthma_risk" value="Occupational exposures" /> Occupational exposures</label></li>
        <li><label><input type="checkbox" name="asthma_risk" value="Smoking" /> Smoking</label></li>
        <li><label><input type="checkbox" name="asthma_risk" value="Air pollution" /> Air pollution</label></li>
        <li><label><input type="checkbox" name="asthma_risk" value="Obesity" /> Obesity</label></li>
      </ul>
    </div>

    <!-- COPD -->
    <div class="section">
      <h3>COPD</h3>
      <ul>
        <li><label><input type="checkbox" name="copd_risk" value="Age 40 years and above" /> Age 40 years and above</label></li>
        <li><label><input type="checkbox" name="copd_risk" value="History of smoking" /> History of smoking</label></li>
        <li><label><input type="checkbox" name="copd_risk" value="Long-term exposure to irritants" /> Long-term exposure to irritants</label></li>
        <li><label><input type="checkbox" name="copd_risk" value="Alpha-1 antitrypsin deficiency" /> Alpha-1 antitrypsin deficiency</label></li>
        <li><label><input type="checkbox" name="copd_risk" value="Combination of the above" /> Combination of the above</label></li>
      </ul>
    </div>
  </div>
  
  <!-- Second row: Lung Cancer and Pulmonary TB -->
  <div class="grid-row">
    <!-- Lung Cancer -->
    <div class="section">
      <h3>Lung Cancer</h3>
      <ul>
        <li><label><input type="checkbox" name="lungcancer_risk" value="Age 50–80 years" /> Age 50–80 years</label></li>
        <li><label><input type="checkbox" name="lungcancer_risk" value="Current/former smoker" /> Current/former smoker</label></li>
        <li><label><input type="checkbox" name="lungcancer_risk" value="Secondhand smoke exposure" /> Secondhand smoke exposure</label></li>
        <li><label><input type="checkbox" name="lungcancer_risk" value="Ionizing radiation" /> Ionizing radiation</label></li>
        <li><label><input type="checkbox" name="lungcancer_risk" value="Occupational exposures" /> Occupational exposures</label></li>
        <li><label><input type="checkbox" name="lungcancer_risk" value="Air pollution" /> Air pollution</label></li>
        <li><label><input type="checkbox" name="lungcancer_risk" value="Family history of lung cancer" /> Family history of lung cancer</label></li>
        <li><label><input type="checkbox" name="lungcancer_risk" value="Medical history" /> Medical history (pneumonia, COPD, TB)</label></li>
      </ul>
    </div>

    <!-- Pulmonary TB -->
    <div class="section">
      <h3>Pulmonary TB</h3>
      <ul>
        <li><label><input type="checkbox" name="tuberculosis_risk" value="Contact of TB case" /> Contact of TB case</label></li>
        <li><label><input type="checkbox" name="tuberculosis_risk" value="PLHIV" /> People living with HIV (PLHIV)</label></li>
        <li><label><input type="checkbox" name="tuberculosis_risk" value="Healthcare workers" /> Healthcare workers</label></li>
        <li><label><input type="checkbox" name="tuberculosis_risk" value="Institutional inmates" /> Institutional inmates</label></li>
        <li><label><input type="checkbox" name="tuberculosis_risk" value="Chronic illnesses" /> Chronic illnesses</label></li>
        <li><label><input type="checkbox" name="tuberculosis_risk" value="Immunocompromised" /> Transplant/cancer patients, steroid users</label></li>
        <li><label><input type="checkbox" name="tuberculosis_risk" value="Vulnerable groups" /> Vulnerable groups</label></li>
        <li><label><input type="checkbox" name="tuberculosis_risk" value="Substance abuse clients" /> Substance abuse clients</label></li>
      </ul>
    </div>
  </div>
  
  <div class="puma-container">
    <h2>PUMA Score Calculator</h2>
    <form id="pumaForm">
      <label>1. Gender:
        <select name="sex">
          <option value="0">Female</option>
          <option value="1">Male</option>
        </select>
      </label>
      <label>2. Age:
        <select name="age">
          <option value="0">40–49 years</option>
          <option value="1">50–59 years</option>
          <option value="2">60 years and above</option>
        </select>
      </label>
      <label>3. Smoking history (pack-years):
        <select name="smoking">
          <option value="0">Less than 20</option>
          <option value="1">20–30</option>
          <option value="2">More than 30</option>
        </select>
      </label>
      <label>4. Dyspnea (shortness of breath):
        <select name="dyspnea">
          <option value="0">No</option>
          <option value="1">Yes</option>
        </select>
      </label>
      <label>5. Chronic phlegm (≥3 months):
        <select name="phlegm">
          <option value="0">No</option>
          <option value="1">Yes</option>
        </select>
      </label>
      <label>6. Chronic cough:
        <select name="cough">
          <option value="0">No</option>
          <option value="1">Yes</option>
        </select>
      </label>
      <label>7. Advised to perform Spirometry before:
        <select name="advice">
          <option value="0">No</option>
          <option value="1">Yes</option>
        </select>
      </label>
      <button type="button" onclick="calculate()">Calculate Score</button>
    </form>
    <div id="result"></div>
  </div>

  <div class="form-container">
    <h2>SARINGAN KESIHATAN PARU-PARU</h2>
  
    <form id="health-form">
      <div class="floating-label">
        <input type="text" name="nama" placeholder=" " required autocapitalize="characters" autocomplete="off" autocorrect="off" spellcheck="false">
        <label for="nama">Nama</label>
      </div>

      <div class="floating-label">
        <input type="text" name="nric" placeholder=" " required autocapitalize="characters" autocomplete="off" autocorrect="off" spellcheck="false">
        <label for="nric">NRIC / Passport</label>
      </div>

      <label for="puma"><strong>PUMA Score:</strong></label>
      <input type="number" name="puma" id="pumaScoreInput" required readonly>

      <div class="section">
        <label><strong>A. Merokok</strong></label>
        <div class="checkbox-group">
          <label>Adakah anda merokok <input type="checkbox" name="merokok" value="Masih merokok"></label>
          <label>Adakah anda bekas perokok <input type="checkbox" name="merokok" value="Pernah merokok"></label>
          <label>Adakah anda terdedah kepada asap rokok <input type="checkbox" name="merokok" value="Terdedah kepada asap rokok"></label>
          <label>Tidak merokok <input type="checkbox" name="merokok" value="Tidak merokok"></label>
        </div>
      </div>

      <div class="section">
        <label><strong>B. Pencemaran Alam Sekitar</strong></label>
        <div class="checkbox-group">
          <label>Pencemaran udara seperti asap kenderaan <input type="checkbox" name="pencemaran" value="Terdedah kepada pencemaran"></label>
          <label>Tidak terdedah <input type="checkbox" name="pencemaran" value="Tidak terdedah"></label>
        </div>
      </div>

      <div class="section">
        <label><strong>C. Pendedahan di tempat Kerja</strong></label>
        <div class="checkbox-group">
          <label>Asap industri/ bahan bakar/ bahan kimia/ radiasi <input type="checkbox" name="tempat_kerja" value="Pekerjaan berisiko"></label>
          <label>Tiada risiko pekerjaan <input type="checkbox" name="tempat_kerja" value="Tiada risiko pekerjaan"></label>
        </div>
      </div>

      <div class="button-container">
        <button type="submit" class="submit-button">
          Hantar
          <div class="spinner" id="spinner"></div>
        </button>
      </div>
    </form>
  </div>

  <script>
    function calculate() {
      const form = document.forms['pumaForm'];
      const fields = ['sex', 'age', 'smoking', 'dyspnea', 'phlegm', 'cough', 'advice'];
      let score = 0;
      fields.forEach(field => {
        score += parseInt(form[field].value);
      });

      let message = 'PUMA Score: ' + score + '/9 — ';
      message += score >= 5
        ? 'High risk. Spirometry examination is recommended.'
        : 'Low to moderate risk. For yearly PUMA assessment';

      document.getElementById('result').innerText = message;
      document.getElementById('pumaScoreInput').value = score;
    }

     document.getElementById("health-form").addEventListener("submit", function(e) {
	e.preventDefault();

	const spinner = document.getElementById("spinner");
	spinner.style.display = "inline-block";

	const form = e.target;
	const data = new FormData(form);
	
	// Collect all checkboxes from risk sections and group them
       	const collectCheckboxValues = (name) => {
     	return [...document.querySelectorAll(`input[name="${name}"]:checked`)].map(cb => cb.value).join(', ');
       };

	// Risk groups
 	const asthma = collectCheckboxValues("asthma_risk");
  const copd = collectCheckboxValues("copd_risk");
 	const lungcancer = collectCheckboxValues("lungcancer_risk");
	const tuberculosis = collectCheckboxValues("tuberculosis_risk");
	const merokok = collectCheckboxValues("merokok");
	const pencemaran = collectCheckboxValues("pencemaran");
 	const tempat_kerja = collectCheckboxValues("tempat_kerja");

	// Prepare data object
      const payload = {
    	nama: data.get("nama").toUpperCase(),
   	nric: data.get("nric").toUpperCase(),
    	puma: data.get("puma"),
   	asthma,
   	copd,
    	lungcancer,
    	tuberculosis,
    	merokok,
    	pencemaran,
    	tempat_kerja,
    	timestamp: new Date().toISOString()
       };

	// Submit to Google Apps Script Web App
 	fetch("https://script.google.com/macros/s/AKfycbye15OVIa-gHv6ddAzRBw24lIzerAyNHRevYJB6fvivDkFLUMbeJbPtrrpexDqcsHjmfg/exec", {
    	method: "POST",
    	mode: "no-cors",
    	headers: {
      	"Content-Type": "application/json"
        },

     body: JSON.stringify(payload)
  	})
  	.then(() => {
   	 spinner.style.display = "none";
    	alert("Maklumat berjaya dihantar!");
    	form.reset();
    	document.getElementById("result").innerText = "";
    	document.getElementById("pumaScoreInput").value = "";
    
    // Clear risk checkboxes outside the form manually
      const riskCheckboxNames = [
       "asthma_risk",
       "copd_risk",
       "lungcancer_risk",
       "tuberculosis_risk"
      ];
    
    riskCheckboxNames.forEach(name => {
      document.querySelectorAll(`input[name="${name}"]:checked`).forEach(cb => {
        cb.checked = false;
      });
    });
  })
  	.catch(err => {
    	spinner.style.display = "none";
    	console.error("Submission error:", err);
    	alert("Ralat semasa penghantaran. Sila cuba semula.");
            	 });
      });
       
    </script>
</body>
</html>
